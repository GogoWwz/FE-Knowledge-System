## HTTPS

HTTP Secure：安全的HTTP

首先HTTP虽然简单高效，但也正因为此，会有以下不安全的问题：

- 明文通信，未加密，可能会被窃取
- 不会验证对方身份，可能会遭遇伪装导致被欺骗

所以，为了安全，就需要配合SSL(Secure Socket Layer，安全套接层)，结合起来就叫HTTPS：

HTTPS = HTTP + 加密 + 认证

了解SSL之前，我们先得知道一下两种加密方法：

- 共享密钥加密(对称加密)

  加解密使用同一把密钥，所以会有个问题：如何安全的传递密钥，毕竟只要拿到密钥，加密也就失去了意义

- 公开密钥加密(不对称加密)

  使用两把密钥：私有密钥和公开密钥，公开密钥解密的数据只有通过私有密钥才能解密

  使用者手中同时有这两把密钥，公开密钥可以转交给任何人，告知对方用公开密钥加密信息，当拿到信息之后，用自己的私有密钥解密。这样私有密钥一直在使用者手里，不需要传递，也就避免了共享密钥加密的问题

  但公开密钥加密也有问题：速度慢（涉及到密钥的算法问题，有兴趣可以深入了解）

所以HTTPS采用了**混合加密**的方式，结合了对称加密和不对称加密，流程如下：

- 客户端向向服务器发起HTTPS请求，开始建立SSL连接
- 服务器接收到之后，会返回一个公钥A，同时自己有一个配套的私钥B
- 客户端收到公钥A后，会生成一个随机数密钥C
- 客户端将密钥C用公钥A加密后，传给服务器（因为是不对称加密，所以即使被看到也没事，解密不出来）
- 服务器拿到后，用私钥B解密，得到了密钥C
- 后面的通信就以密钥C来进行对称加密了

那既然HTTPS是安全，为什么不都用HTTPS好了呢？

当然还是性能和速度原因，通过上面的介绍可以发现，HTTPS相对于HTTP，一方面增加了SSL通信，另一方面又增加了加解密的操作，对通信速度和双方的负载都有影响。

上面的加密流程我们可以发现，虽然可以进行加密通信了，但是身份认证这一块还是没有解决

攻击者可以伪装成服务端给客户端发公钥，这样就窃取了密钥了

所以这个时候就需要权威的第三方证书机构（CA）来介入了

该机构会对正规的服务端通过域名、公司信息、序列号等数据生成一份证书

客户端里会维护一套所有CA机构的公钥进行匹配解密

当建立SSL连接的时候，服务端同时会返回一份证书，客户端通过比对之后发现是合法的，就会拿出对应的公钥给客户端使用了

这样组合就解决了HTTP明文传输 + 身份伪造的问题了